const fs = require('fs')

const parsed = JSON.parse(fs.readFileSync('parsed.json'))

console.log(createTestCode(parsed[0]))

function createRequestBody(paragraph) {
    return paragraph.annotation
}

function createTestFile(paragraphs) {
    const testCases = paragraphs.reduce((acc, paragraph) => acc += createTestCode(paragraph), '')

    return `
// This file is generated by the Bot end to end testing framework
const axios = require('axios')

describe('The API should work for', () => {
    ${testCases}
})
`
}

function createTestCode(paragraph) {
    return `
    it('[${paragraph.annotation.intent}] ${paragraph.annotation.conditions && paragraph.annotation.conditions ? printConditions(paragraph.annotation.conditions) : 'none'}', (done) => {
        request({
            uri: API_ENDPOINT + '/dialogflow/message',
            method: 'POST',
            json: ${createRequestBody(paragraph)}
        }, (err, res, body) => {
            if (err) done.fail(err)
            expect(res.statusCode).toBe(200)
            done()
        })
    })
    `
}

function printConditions(conditions) {
    return conditions.reduce((acc, condition) => acc += `(${condition.key} ${condition.compare} ${condition.value}) `, '')
}
